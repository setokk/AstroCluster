<div class="title-container">
    @if (chartDataPPC.length > 0) {
        <h2>Result for analysis {{ getAnalysisResponse!.analysisData.projectUUID }}</h2>
        <h3>Currently showing: <a style="user-select: none; cursor: pointer;" (click)="onClickCurrentlyShowing()">{{ activeChartTitle }}</a></h3>
    } @else {
        <h2></h2>
        <h3></h3>
    }
</div>

@if (chartDataPPC.length > 0) {
    <div class="flex-row-container" style="margin-top: -10px;">
        <!-- Left aligned content. Charts placement -->
        <div class="left-aligned-content">
            @if (activeChartTitle === 'Percentages per Cluster') {
                <ngx-charts-bar-horizontal
                        [view]="[graphWidth, graphHeight]"
                        [results]="chartDataPPC"
                        [scheme]="colorSchemePPC"
                        [gradient]="false"
                        [xAxis]="true"
                        [yAxis]="true"
                        [legend]="true"
                        [showXAxisLabel]="true"
                        [xAxisLabel]="'Percentage (%)'"
                        [showYAxisLabel]="true"
                        [yAxisLabel]="'Cluster Labels'">
                </ngx-charts-bar-horizontal>
            } @else if (activeChartTitle === 'Cluster File Results') {
                <h3>Total number of analyzed files:
                    <a style="user-select: none;">
                        {{ this.getAnalysisResponse!.analysisData.clusterResults!.length }}
                    </a>
                </h3>
                <ngx-graph
                        class="chart-container"
                        [view]="[graphWidth, graphHeight]"
                        [nodes]="nodesFCL"
                        [links]="[]"
                        [autoCenter]="true">
                    <!-- Node Template -->
                    <ng-template #nodeTemplate let-node>
                        <svg:g [attr.transform]="translate(node.data.customX, node.data.customY)">
                            <svg:circle
                                    r="10"
                                    [attr.fill]="node.data.customColor"
                                    stroke="white"
                                    stroke-width="1">
                            </svg:circle>
                            <svg:text
                                    text-anchor="middle"
                                    y="4"
                                    font-size="10"
                                    fill="black">
                                {{ node.data.clusterLabel }}
                            </svg:text>
                            <svg:text
                                    text-anchor="middle"
                                    y="22"
                                    font-size="10"
                                    fill="white">
                                {{ node.label }}
                            </svg:text>
                        </svg:g>
                    </ng-template>
                </ngx-graph>
            }
        </div>

        <!-- Right aligned content. Specific options based on chart -->
        <div class="right-aligned-content" id="analysis-result-pane">
            @if (activeChartTitle === 'Percentages per Cluster') {
                <div class="flex-row-container">
                    <div class="left-aligned-content-flex" style="padding-right: 50px;">
                        <p>Project name: {{ this.getAnalysisResponse!.analysisData.gitProjectName }}</p>
                        <p>Git url:
                            <a href="{{ this.getAnalysisResponse!.analysisData.gitUrl }}" target="_blank">
                                {{ this.getAnalysisResponse!.analysisData.gitProjectName }}.git
                            </a>
                        </p>
                        <p>Project Language: {{ this.getAnalysisResponse!.analysisData.projectLang }}</p>
                    </div>
                    <div class="right-aligned-content">
                        <label for="topClustersRange">Top K={{ topClustersValue }} Clusters:</label>
                        <input type="range"
                               min="1" max="{{ this.getAnalysisResponse!.percentagesPerCluster!.length }}"
                               [(ngModel)]="topClustersValue"
                               (change)="onChangeTopClustersValuePPC($event)"
                               name="topClustersRange" id="topClustersRange"/>
                        <label for="lastClustersRange">Last N={{ lastClusterValue }} Clusters:</label>
                        <input type="range"
                               min="1" max="{{ this.getAnalysisResponse!.percentagesPerCluster!.length }}"
                               [(ngModel)]="lastClusterValue"
                               (change)="onChangeLastClustersValuePPC($event)"
                               name="lastClustersRange" id="lastClustersRange"/>
                        <button (click)="onClickReset()">Reset</button>
                    </div>
                </div>
            }
            <h3>Technical Debt Analysis:</h3>
            <form (ngSubmit)="onAnalysisPdfSubmit(f)" #f="ngForm">
                <div class="flex-row-container">
                    <app-dropdown-list
                            [label]="'Similar Files Criteria:'"
                            [name]="'similarFilesCriteria'"
                            [options]="similarFilesCriteria"
                            (valueChange)="onDropdownChange('similarFilesCriteria', $event)">
                    </app-dropdown-list>
                    <label for="isDescriptive" class="ac-checkbox-container" style="margin-left: 20px; margin-top: 45px;">
                        <input type="checkbox" name="isDescriptive" class="ac-checkbox" id="isDescriptive" ngModel />
                        <span class="ac-checkmark"></span>
                        Descriptive
                    </label>
                </div>
                <div class="flex-row-container">
                    <div class="right-aligned-content">
                        <label for="avgPerGenerationLOC">Avg LOC (per generation)</label>
                        <input type="number" name="avgPerGenerationLOC" id="avgPerGenerationLOC" ngModel />
                    </div>
                    <div class="right-aligned-content">
                        <label for="perHourLOC">LOC (per hour)</label>
                        <input type="number" name="perHourLOC" id="perHourLOC" ngModel />
                    </div>
                    <div class="right-aligned-content">
                        <label for="perHourSalary">Salary (per hour)</label>
                        <input type="number" name="perHourSalary" id="perHourSalary" ngModel />
                    </div>
                </div>
                <button id="interest-pdf-btn" type="submit">Download Analysis PDF</button>
            </form>
        </div>
    </div>
}